{%- liquid
  assign show_on_desktop = section.settings.show_on_desktop
  assign show_on_mobile = section.settings.show_on_mobile
  assign section_style = section.settings.section_style
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign logo_size = section.settings.logo_size
  assign logo_size_mobile = section.settings.logo_size_mobile
  assign enable_gray_logos = section.settings.enable_gray_logos
  assign enable_card = section.settings.enable_card
  assign show_dots = section.settings.show_dots
  assign show_arrows = section.settings.show_arrows
  assign enable_autoplay = section.settings.enable_autoplay
  assign autoplay_speed = section.settings.autoplay_speed | times: 1000
  assign slides_amount = section.settings.slides_amount
  assign slides_amount_mobile = section.settings.slides_amount_mobile

  assign images_loading_type = section.settings.images_loading_type
  assign display_type = section.settings.display_type
  assign color_scheme = section.settings.color_scheme

  assign enable_slider = false

  if display_type == 'carousel' and section.blocks.size > 1
    assign enable_slider = true
  endif

  assign default_scrolling_speed = 15
  assign scrolling_speed_multiplier = section.settings.scrolling_speed | divided_by: 100.0

  if scrolling_speed_multiplier > 1
    assign calculated_scrolling_speed = default_scrolling_speed | times: 1.0 | divided_by: scrolling_speed_multiplier
  else
    assign calculated_scrolling_speed = 2 | minus: scrolling_speed_multiplier | times: default_scrolling_speed
  endif

  capture visibility_class
    render 'section-visibility-class', show_on_mobile: show_on_mobile, show_on_desktop: show_on_desktop
  endcapture

  capture block_width
    render 'section-block-width', section: section, type: 'block'
  endcapture
-%}

{%- capture section_settings -%}
  {
  "enableSlider": {{ enable_slider | json }},
  "showDots": {{ show_dots | json }},
  "showArrows": {{ show_arrows | json }},
  "enableAutoplay": {{ enable_autoplay | json }},
  "autoplaySpeed": {{ autoplay_speed | json }},
  "slidesToShow": {{ slides_amount | json }},
  "slidesToShowMobile": {{ slides_amount_mobile | json }}
  }
{%- endcapture -%}

<style>
    [data-section-id="{{ section.id }}"] .animate-marquee {
        --speed: {{ calculated_scrolling_speed }}s;
        --direction: {{ section.settings.scrolling_direction }};
    }

    {% if section.settings.auto_scrolling_pause_on_hover %}
    [data-section-id="{{ section.id }}"]:hover .animate-marquee {
        --play-state: paused;
    }
    {% endif %}
</style>

{%- if section.blocks.size > 0 -%}
  <div class="dbtfy-logo-list section section--{{ section_style }} {{ visibility_class }} color-{{ color_scheme }}" data-section-id="{{ section.id }}" data-section-settings='{{ section_settings }}'>
    <div class="dbtfy-logo-list__container container">
      {%- if heading != blank or subheading != blank -%}
        {%- render 'section-header', heading: heading, subheading: subheading, container: container_size -%}
      {%- endif -%}

      <div class="row row--sm row-cols-auto justify-content-center align-items-center">
        <div class="dbtfy-logo-list__slider row row--sm row-cols-md-auto justify-content-center{% if display_type == 'auto-scrolling' %} animate-marquee flex-nowrap{% endif %}{% if enable_slider %} slick js-slider{% endif %}" data-slides-count="{{ section.blocks.size }}">
          {%- if display_type == 'auto-scrolling' -%}
            {%- for i in (1..10) -%}
              {%- for block in section.blocks -%}
                {%- liquid
                  assign heading = block.settings.title
                  assign text = block.settings.text
                  assign image = block.settings.image
                  assign image_link = block.settings.image_link
                  assign open_link_in_new_tab = block.settings.open_link_in_new_tab

                  assign image_class = 'image'

                  if enable_gray_logos
                    assign image_class = image_class | append: ' image--gray'
                  endif
                -%}

                {%- render 'dbtfy-logo-list', heading: heading, text: text, image: image, image_link: image_link, enable_card: enable_card, enable_gray_logos: enable_gray_logos, logo_size: logo_size, logo_size_mobile: logo_size_mobile, image_class: image_class, open_link_in_new_tab: open_link_in_new_tab, show_placeholder: true, images_loading_type: images_loading_type -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- else -%}
            {%- for block in section.blocks -%}
              {%- liquid
                assign heading = block.settings.title
                assign text = block.settings.text
                assign image = block.settings.image
                assign image_link = block.settings.image_link
                assign open_link_in_new_tab = block.settings.open_link_in_new_tab

                assign image_class = 'image'

                if enable_gray_logos
                  assign image_class = image_class | append: ' image--gray'
                endif
              -%}

              {%- render 'dbtfy-logo-list', heading: heading, text: text, image: image, image_link: image_link, enable_card: enable_card, enable_gray_logos: enable_gray_logos, logo_size: logo_size, logo_size_mobile: logo_size_mobile, image_class: image_class, open_link_in_new_tab: open_link_in_new_tab, images_loading_type: images_loading_type -%}
            {%- endfor -%}
          {%- endif -%}
        </div>
      </div>
    </div>
  </div>

{%- endif -%}

{% schema %}
{
  "name": "t:sections.logo_list.name",
  "class": "dbtfy-logo-list",
  "max_blocks": 10,
  "disabled_on": {
    "groups": [
      "custom.widgets",
      "custom.general",
      "header"
    ]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "show_on_desktop",
      "label": "t:general.settings.show_on_desktop.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_on_mobile",
      "label": "t:general.settings.show_on_mobile.label",
      "default": true
    },
    {
      "type": "select",
      "id": "section_style",
      "label": "t:general.settings.section_style.label",
      "default": "blank",
      "options": [
        {
          "value": "blank",
          "label": "t:general.settings.section_style.options__1.label"
        },
        {
          "value": "default",
          "label": "t:general.settings.section_style.options__2.label"
        },
        {
          "value": "border",
          "label": "t:general.settings.section_style.options__3.label"
        }
      ]
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:general.settings.heading.label",
      "default": "Featured on"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:general.settings.subheading.label"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "select",
      "id": "display_type",
      "label": "Logos display type",
      "default": "grid",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "carousel",
          "label": "Carousel"
        },
        {
          "value": "auto-scrolling",
          "label": "Auto-scrolling"
        }
      ]
    },
    {
      "type": "range",
      "id": "logo_size",
      "label": "t:sections.logo_list.settings.logo_size.label",
      "min": 60,
      "max": 240,
      "step": 2,
      "unit": "px",
      "default": 120
    },
    {
      "type": "range",
      "id": "logo_size_mobile",
      "label": "Logo size mobile",
      "min": 60,
      "max": 180,
      "step": 2,
      "unit": "px",
      "default": 80
    },
    {
      "type": "checkbox",
      "id": "enable_gray_logos",
      "label": "t:sections.logo_list.settings.enable_gray_logos.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_card",
      "label": "t:sections.logo_list.settings.enable_card.label",
      "default": true
    },
    {
      "type": "header",
      "content": "Auto-scrolling"
    },
    {
      "type": "select",
      "id": "scrolling_direction",
      "options": [
        {
          "value": "normal",
          "label": "Left"
        },
        {
          "value": "reverse",
          "label": "Right"
        }
      ],
      "default": "normal",
      "label": "Direction"
    },
    {
      "type": "range",
      "id": "scrolling_speed",
      "min": 1,
      "max": 30,
      "step": 1,
      "unit": "s",
      "label": "Scrolling speed",
      "default": 24
    },
    {
      "type": "checkbox",
      "id": "auto_scrolling_pause_on_hover",
      "label": "Pause on hover",
      "default": true
    },
    {
      "type": "header",
      "content": "Carousel"
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "t:sections.logo_list.settings.show_dots.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "t:sections.logo_list.settings.enable_autoplay.label",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "label": "t:sections.logo_list.settings.autoplay_speed.label",
      "default": 5,
      "unit": "s"
    },
    {
      "type": "range",
      "id": "slides_amount",
      "min": 2,
      "max": 6,
      "label": "Slides to show on desktop",
      "default": 3
    },
    {
      "type": "range",
      "id": "slides_amount_mobile",
      "min": 1,
      "max": 3,
      "label": "Slides to show on mobile",
      "default": 1
    },
    {
      "type": "header",
      "content": "t:general.settings.images_loading.header.content"
    },
    {
      "type": "select",
      "id": "images_loading_type",
      "label": "t:general.settings.images_loading.images_loading_type.label",
      "default": "lazy",
      "options": [
        {
          "value": "lazy",
          "label": "t:general.settings.images_loading.images_loading_type.options__1.label"
        },
        {
          "value": "eager",
          "label": "t:general.settings.images_loading.images_loading_type.options__2.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "t:sections.logo_list.blocks.logo.name",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "t:general.sections.blocks.block_name.label",
          "info": "t:general.sections.blocks.block_name.info"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "t:general.settings.image.label"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Title"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text"
        },
        {
          "type": "url",
          "id": "image_link",
          "label": "t:general.settings.image_link.label"
        },
        {
          "type": "checkbox",
          "id": "open_link_in_new_tab",
          "label": "t:sections.logo_list.blocks.logo.settings.open_link_in_new_tab.label"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "t:sections.logo_list.presets.name",
      "category": "t:sections.logo_list.presets.category",
      "blocks": [
        {
          "type": "logo"
        },
        {
          "type": "logo"
        },
        {
          "type": "logo"
        },
        {
          "type": "logo"
        }
      ]
    }
  ]
}
{% endschema %}
  