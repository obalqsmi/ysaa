{%- liquid
  assign show_on_desktop = section.settings.show_on_desktop
  assign show_on_mobile = section.settings.show_on_mobile
  assign section_style = section.settings.section_style
  assign container_size = section.settings.container_size
  assign heading = section.settings.heading
  assign subheading = section.settings.subheading
  assign collection = collections[section.settings.collection]
  assign number_of_rows = section.settings.number_of_rows
  assign products_per_row_desktop = section.settings.products_per_row_desktop
  assign products_per_row_mobile = section.settings.products_per_row_mobile
  assign show_button = section.settings.show_button
  assign button_label = section.settings.button_label
  assign button_link = section.settings.button_link | default: collection.url
  assign button_style = section.settings.button_style
  assign show_arrows = section.settings.show_arrows
  assign show_dots = section.settings.show_dots
  assign enable_autoplay = section.settings.enable_autoplay
  assign autoplay_speed = section.settings.autoplay_speed | times: 1000
  assign images_loading_type = section.settings.images_loading_type
  assign color_scheme = section.settings.color_scheme
  assign maximum_list_products_to_show = section.settings.maximum_list_products_to_show

  assign products_limit = number_of_rows | times: products_per_row_desktop
  assign products_limit_on_mobile = number_of_rows | times: products_per_row_mobile

  assign gift_wrap_product = settings.dbtfy_gift_wrap_product

  assign heading_size = section.settings.heading_size
  assign subheading_size = section.settings.subheading_size
  assign subheading_position = section.settings.subheading_position
  assign headings_text_alignment = section.settings.headings_text_alignment
  assign product_text_alignment = section.settings.product_text_alignment
  assign display_type = section.settings.display_type
  assign slide_per = section.settings.slide_per
  assign layout_width = section.settings.layout_width
  assign custom_width = section.settings.custom_width
  assign image_size = section.settings.image_shape

  assign show_out_of_stock_products = section.settings.show_out_of_stock_products
  assign show_color_swatches = section.settings.show_color_swatches
  assign show_product_rating = section.settings.show_product_rating
  assign show_product_price = section.settings.show_product_price
  assign show_product_vendor = section.settings.show_product_vendor
  assign show_sold_out_badge = section.settings.show_sold_out_badge
  assign show_sales_badge = section.settings.show_sales_badge
  assign product_grid_badge_placement = section.settings.product_grid_badge_placement
  assign enable_quick_view = section.settings.enable_quick_view
  assign enable_carousel_for_mobile = section.settings.enable_carousel_for_mobile
  assign custom_badge_label = section.settings.custom_badge_label
  assign custom_badge_icon = section.settings.custom_badge_icon
  assign badge_background_color = section.settings.badge_background_color
  assign badge_text_color = section.settings.badge_text_color
  assign custom_font_family = section.settings.font_family
  assign custom_font_stack = custom_font_family.family | append: ", " | append: custom_font_family.fallback_families

  assign enable_slider = false

  if display_type == 'carousel'
    assign enable_slider = true
  endif

  if display_type == "grid" and enable_carousel_for_mobile
    assign enable_slider = true
  endif

  if display_type == "list"
    assign products_limit = maximum_list_products_to_show
  endif

  assign empty_state = false

  if collection == blank or collection.products_count == 0
    assign empty_state = true
  endif

  capture visibility_class
    render 'section-visibility-class', show_on_mobile: show_on_mobile, show_on_desktop: show_on_desktop
  endcapture

  capture block_width
    render 'section-block-width', section: section, type: 'product'
  endcapture

  if slide_per == 'item'
    assign slides_to_scroll = 1
  else
    assign slides_to_scroll = products_per_row_desktop | times: 1
  endif
-%}

{%- capture section_settings -%}
  {
    "enableSlider": {{ enable_slider | json }},
    "showArrows": {{ show_arrows | json }},
    "showDots": {{ show_dots | json }},
    "enableAutoplay": {{ enable_autoplay | json }},
    "autoplaySpeed": {{ autoplay_speed | json }},
    "slidesToShow": {{ products_per_row_desktop | times: 1 | json }},
    "slidesToScroll": {{ slides_to_scroll | json }},
    "enableCarouselForMobileOnly": {{ enable_carousel_for_mobile | json }},
    "displayType": {{ display_type | json }}
  }
{%- endcapture -%}

<style>
  {% if layout_width == 'custom' %}
    .dbtfy-featured-collection [data-section-id='{{ section.id }}'] .container {
      max-width: {{ custom_width }}px;
    }
  {% endif %}

  .dbtfy-featured-collection [data-section-id='{{ section.id }}'] .padding-top-unset {
    padding-top: unset!important;
  }

  {% if display_type == "grid" and enable_carousel_for_mobile == true %}
    .dbtfy-featured-collection [data-section-id='{{ section.id }}'] .featured-collection-grid.slick {
      opacity: 1;
    }

    @media screen and (min-width: 767.98px) {
      .dbtfy-featured-collection [data-section-id='{{ section.id }}'] .product-item {
        margin-bottom: var(--gutter);
      }
    }
{% endif %}

  .dbtfy-featured-collection [data-section-id='{{ section.id }}'] .h4.text-ellipsis {
     font-family: {{ custom_font_stack }};
  }

  @media screen and (min-width: 767.98px) {
    .dbtfy-featured-collection [data-section-id='{{ section.id }}'] .row-cols-lg-5 .product-item{
      width: 20%!important;
    }
  }
</style>

<div class="section section--{{ section_style }} {{ visibility_class }} color-{{ color_scheme }}" data-section-type="featured-collection" data-section-id="{{ section.id }}" data-section-settings='{{ section_settings }}'>
  <div class="{{ container_size }}">
    {%- if heading != blank or subheading != blank -%}
      <div class="row mb-4">
        <div>
          <div class="row gy-3{% if container == 'container-full' %} px-2-5{% endif %} {% if headings_text_alignment %} {{ headings_text_alignment }}{% else %} text-center{% endif %}">

            {%- if subheading != blank and subheading_position == "above-heading" -%}
              <p style="font-size: {{ subheading_size }}px;"  class="sm:text-lg text-break-all rte">{{ subheading }}</p>
            {%- endif -%}


            {%- if heading != blank -%}
              <div>
                <h2 style="font-size: {{ heading_size }}px;" class="h2 {% if enlarge %} page-title{% endif %}">{{ heading | escape }}</h2>
              </div>
            {%- endif -%}

            {%- if subheading != blank and subheading_position == "below-heading" -%}
              <p style="font-size: {{ subheading_size }}px;"  class="sm:text-lg text-break-all rte">{{ subheading }}</p>
            {%- endif -%}
          </div>
        </div>
      </div>
    {%- endif -%}

    <div class="{% if products_per_row_desktop == '5' %} row-cols-lg-5{% endif %}  row{% if enable_slider %} slick js-slider{% else %} gy-4{% endif %} {% if display_type == "grid" %} featured-collection-grid {% endif %}">
      {%- liquid
        if empty_state
          for i in (1..products_limit)
            capture current
              cycle 1, 2, 3, 4, 5, 6
            endcapture

            assign product_class = ''

            if enable_slider == false and forloop.index > products_limit_on_mobile
              assign product_class = 'd-none d-md-block'
            endif

            if display_type == 'list'
              render 'product-list-item', empty_state: empty_state, visible: true, block_width: block_width, current: current, products_per_row_desktop: products_per_row_desktop, products_per_row_mobile: products_per_row_mobile, images_loading_type: images_loading_type, class: product_class, product_text_alignment: product_text_alignment, image_size: image_size, show_color_swatches: show_color_swatches, show_product_rating: show_product_rating, show_product_price: show_product_price, show_product_vendor: show_product_vendor, show_sold_out_badge: show_sold_out_badge, show_sales_badge: show_sales_badge, product_grid_badge_placement: product_grid_badge_placement, enable_quick_view: enable_quick_view, custom_badge_label: custom_badge_label, custom_badge_icon: custom_badge_icon, badge_background_color: badge_background_color, badge_text_color: badge_text_color
            else
              render 'product-grid-item', empty_state: empty_state, block_width: block_width, current: current, class: product_class, product_text_alignment: product_text_alignment, image_size: image_size, show_color_swatches: show_color_swatches, show_product_rating: show_product_rating, show_product_price: show_product_price, show_product_vendor: show_product_vendor, show_sold_out_badge: show_sold_out_badge, show_sales_badge: show_sales_badge, product_grid_badge_placement: product_grid_badge_placement, enable_quick_view: enable_quick_view, custom_badge_label: custom_badge_label, custom_badge_icon: custom_badge_icon, badge_background_color: badge_background_color, badge_text_color: badge_text_color
            endif
          endfor
        else
          for product in collection.products limit: products_limit
            capture product_item
              capture current
                cycle 1, 2, 3, 4, 5, 6
              endcapture

              assign product_class = ''

              if enable_slider == false and forloop.index > products_limit_on_mobile
                assign product_class = 'd-none d-md-block'
              endif

              assign display_product = true

              if show_out_of_stock_products == false
                if product.available == false
                  assign display_product = false
                endif
              endif

              if display_product
                if display_type == 'list'
                  render 'product-list-item', product: product, visible: true, block_width: block_width, current: current, products_per_row_desktop: products_per_row_desktop, products_per_row_mobile: products_per_row_mobile, images_loading_type: images_loading_type, class: product_class, product_text_alignment: product_text_alignment, image_size: image_size, show_color_swatches: show_color_swatches, show_product_rating: show_product_rating, show_product_price: show_product_price, show_product_vendor: show_product_vendor, show_sold_out_badge: show_sold_out_badge, show_sales_badge: show_sales_badge, product_grid_badge_placement: product_grid_badge_placement, enable_quick_view: enable_quick_view, custom_badge_label: custom_badge_label, custom_badge_icon: custom_badge_icon, badge_background_color: badge_background_color, badge_text_color: badge_text_color
                else
                  render 'product-grid-item', product: product, block_width: block_width, current: current, products_per_row_desktop: products_per_row_desktop, products_per_row_mobile: products_per_row_mobile, images_loading_type: images_loading_type, class: product_class, product_text_alignment: product_text_alignment, image_size: image_size, show_color_swatches: show_color_swatches, show_product_rating: show_product_rating, show_product_price: show_product_price, show_product_vendor: show_product_vendor, show_sold_out_badge: show_sold_out_badge, show_sales_badge: show_sales_badge, product_grid_badge_placement: product_grid_badge_placement, enable_quick_view: enable_quick_view, custom_badge_label: custom_badge_label, custom_badge_icon: custom_badge_icon, badge_background_color: badge_background_color, badge_text_color: badge_text_color
                endif
              endif
            endcapture

            if product.id != gift_wrap_product.id
              echo product_item
            endif
          endfor
        endif
      -%}
    </div>

    {%- if show_button and button_label != blank and button_link != blank -%}
      <div class="mt-4 text-center">
        <a href="{{ button_link }}" class="btn {{ button_style }}">{{ button_label }}</a>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "t:sections.featured_collection.name",
  "class": "dbtfy-featured-collection",
  "disabled_on": {
    "groups": [
      "custom.widgets",
      "custom.general",
      "header"
    ]
  },
  "settings": [
    {
      "type": "header",
      "content": "t:general.addons.help_center.header.content"
    },
    {
      "type": "paragraph",
      "content": "t:general.addons.help_center.featured_collection.content"
    },
    {
      "type": "paragraph",
      "content": "t:general.addons.help_center.enable_disable.content"
    },
    {
      "type": "header",
      "content": "t:general.addons.languages.header.content"
    },
    {
      "type": "paragraph",
      "content": "t:general.addons.languages.paragraph__1.content"
    },
    {
      "type": "paragraph",
      "content": "t:general.addons.languages.paragraph__2.content"
    },
    {
      "type": "header",
      "content": "t:general.addons.settings.header.content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:general.settings.heading.label",
      "default": "Featured collection"
    },
    {
      "type": "range",
      "id": "heading_size",
      "label": "Heading font size",
      "min": 10,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 20
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "t:general.settings.subheading.label"
    },
    {
      "type": "range",
      "id": "subheading_size",
      "label": "Subheading font size",
      "min": 10,
      "max": 60,
      "step": 2,
      "unit": "px",
      "default": 16
    },
    {
      "type": "select",
      "id": "subheading_position",
      "label": "Subheading position",
      "default": "below-heading",
      "options": [
        {
          "value": "below-heading",
          "label": "Below the heading"
        },
        {
          "value": "above-heading",
          "label": "Above the heading"
        }
      ]
    },
    {
      "type": "select",
      "id": "headings_text_alignment",
      "label": "Heading/Subheading alignment",
      "default": "justify-content-start text-start",
      "options": [
        {
          "value": "justify-content-start text-start",
          "label": "t:general.settings.text_alignment.options__1.label"
        },
        {
          "value": "justify-content-center text-center",
          "label": "t:general.settings.text_alignment.options__2.label"
        },
        {
          "value": "justify-content-end text-end",
          "label": "t:general.settings.text_alignment.options__3.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "product_text_alignment",
      "label": "Product content alignment",
      "default": "justify-content-start text-start",
      "options": [
        {
          "value": "justify-content-start text-start",
          "label": "t:general.settings.text_alignment.options__1.label"
        },
        {
          "value": "justify-content-center text-center",
          "label": "t:general.settings.text_alignment.options__2.label"
        },
        {
          "value": "justify-content-end text-end",
          "label": "t:general.settings.text_alignment.options__3.label"
        }
      ]
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "t:sections.featured_collection.settings.collection.label"
    },
    {
      "type": "select",
      "id": "display_type",
      "label": "Display type",
      "default": "grid",
      "options": [
        {
          "value": "grid",
          "label": "Grid"
        },
        {
          "value": "carousel",
          "label": "Carousel"
        },
        {
          "value": "list",
          "label": "List"
        }
      ]
    },
    {
      "type": "select",
      "id": "slide_per",
      "label": "Slide per",
      "default": "row",
      "options": [
        {
          "value": "row",
          "label": "Row"
        },
        {
          "value": "item",
          "label": "Item"
        }
      ]
    },
    {
      "type": "range",
      "id": "maximum_list_products_to_show",
      "min": 1,
      "max": 30,
      "label": "Maximum products to show",
      "info": "This setting only applies for list view.",
      "default": 4
    },
    {
      "type": "select",
      "id": "number_of_rows",
      "label": "t:sections.featured_collection.settings.number_of_rows.label",
      "info": "This setting will apply for grid and list views only",
      "default": "2",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        },
        {
          "value": "5",
          "label": "5"
        }
      ]
    },
    {
      "type": "select",
      "id": "products_per_row_desktop",
      "label": "Number of columns on desktop",
      "default": "4",
      "options": [
        {
          "value": "2",
          "label": "2"
        },
        {
          "value": "3",
          "label": "3"
        },
        {
          "value": "4",
          "label": "4"
        },
        {
          "value": "5",
          "label": "5"
        },
        {
          "value": "6",
          "label": "6"
        }
      ]
    },
    {
      "type": "select",
      "id": "products_per_row_mobile",
      "label": "Numbers of columns on mobile",
      "info": "This setting will apply for grid view only.",
      "default": "2",
      "options": [
        {
          "value": "1",
          "label": "1"
        },
        {
          "value": "2",
          "label": "2"
        }
      ]
    },
    {
      "type": "select",
      "id": "layout_width",
      "label": "Layout width",
      "default": "full",
      "options": [
        {
          "value": "full",
          "label": "Full"
        },
        {
          "value": "custom",
          "label": "Custom"
        }
      ]
    },
    {
      "type": "range",
      "id": "custom_width",
      "label": "Custom width",
      "min": 800,
      "max": 2000,
      "step": 20,
      "unit": "px",
      "default": 1000
    },
    {
      "type": "select",
      "id": "image_shape",
      "label": "Image shape",
      "default": "sm",
      "options": [
        {
          "value": "sm",
          "label": "Square"
        },
        {
          "value": "xs",
          "label": "Rectangle"
        },
        {
          "value": "md",
          "label": "Portrait"
        },
        {
          "value": "circle",
          "label": "Circle"
        },
        {
          "value": "oval",
          "label": "Oval"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "show_out_of_stock_products",
      "label": "Show out of stock products",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_color_swatches",
      "label": "Show color swatches",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_rating",
      "label": "Show product rating",
      "info": "t:settings_schema.integrations.settings.review_show_in_product_grid.info",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_price",
      "label": "Show product price",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_product_vendor",
      "label": "Show product vendor",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sold_out_badge",
      "label": "Show sold out badge",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_sales_badge",
      "label": "Show sales badge",
      "default": true
    },
    {
      "type": "select",
      "id": "product_grid_badge_placement",
      "label": "Badges placement",
      "default": "top-left",
      "options": [
        {
          "value": "top-left",
          "label": "t:settings_schema.advanced_settings.settings.product_grid_badge_placement.options__2.label"
        },
        {
          "value": "top-right",
          "label": "t:settings_schema.advanced_settings.settings.product_grid_badge_placement.options__3.label"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "enable_quick_view",
      "label": "Enable quick view button",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_carousel_for_mobile",
      "label": "Change to carousel from grid view in mobile",
      "default": true
    },
    {
      "type": "text",
      "id": "custom_badge_label",
      "label": "Custom badge label",
      "default": "50% OFF"
    },
    {
      "type": "text",
      "id": "custom_badge_icon",
      "label": "Custom badge icon",
      "info": "t:general.settings.icon.info",
      "default": "local_shipping"
    },
    {
      "type": "header",
      "content": "t:sections.featured_collection.settings.header__2.content"
    },
    {
      "type": "checkbox",
      "id": "show_button",
      "label": "t:sections.featured_collection.settings.show_button.label",
      "default": true
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:general.settings.button_label.label",
      "default": "View all"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "t:general.settings.button_link.label",
      "info": "t:sections.featured_collection.settings.button_link.info"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "t:general.settings.button_style.label",
      "default": "btn--primary",
      "options": [
        {
          "value": "",
          "label": "t:general.settings.button_style.options__1.label"
        },
        {
          "value": "btn--primary",
          "label": "t:general.settings.button_style.options__2.label"
        },
        {
          "value": "btn--outline-primary",
          "label": "t:general.settings.button_style.options__3.label"
        }
      ]
    },
    {
      "type": "checkbox",
      "id": "show_on_desktop",
      "label": "t:general.settings.show_on_desktop.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_on_mobile",
      "label": "t:general.settings.show_on_mobile.label",
      "default": true
    },
    {
      "type": "select",
      "id": "section_style",
      "label": "t:general.settings.section_style.label",
      "default": "blank",
      "options": [
        {
          "value": "blank",
          "label": "t:general.settings.section_style.options__1.label"
        },
        {
          "value": "default",
          "label": "t:general.settings.section_style.options__2.label"
        },
        {
          "value": "border",
          "label": "t:general.settings.section_style.options__3.label"
        }
      ]
    },
    {
      "type": "select",
      "id": "container_size",
      "label": "t:general.settings.container_size.label",
      "default": "container",
      "options": [
        {
          "value": "container",
          "label": "t:general.settings.container_size.options__2.label"
        },
        {
          "value": "container-fluid",
          "label": "t:general.settings.container_size.options__3.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.featured_collection.settings.header__3.content"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "t:sections.featured_collection.settings.show_arrows.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_dots",
      "label": "t:sections.featured_collection.settings.show_dots.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "t:sections.featured_collection.settings.enable_autoplay.label",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 3,
      "max": 10,
      "label": "t:sections.featured_collection.settings.autoplay_speed.label",
      "default": 5,
      "unit": "s"
    },
    {
      "type": "header",
      "content": "t:general.settings.images_loading.header.content"
    },
    {
      "type": "select",
      "id": "images_loading_type",
      "label": "t:general.settings.images_loading.images_loading_type.label",
      "default": "lazy",
      "options": [
        {
          "value": "lazy",
          "label": "t:general.settings.images_loading.images_loading_type.options__1.label"
        },
        {
          "value": "eager",
          "label": "t:general.settings.images_loading.images_loading_type.options__2.label"
        }
      ]
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "font_picker",
      "id": "font_family",
      "label": "Font",
      "default": "poppins_n4"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "background-1"
    },
    {
      "type": "color",
      "id": "badge_background_color",
      "label": "Badge background color"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Badge text color"
    }
  ],
  "presets": [
    {
      "name": "t:sections.featured_collection.presets.name",
      "category": "t:sections.featured_collection.presets.category"
    }
  ]
}
{% endschema %}