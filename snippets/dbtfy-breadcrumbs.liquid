{%- if settings.dbtfy_breadcrumbs -%}
  {%- unless request.page_type == 'index' or request.page_type == 'cart' or request.page_type == 'list-collections' or request.page_type == '404' -%}
    {%- if settings.dbtfy_breadcrumbs_show_on_desktop or settings.dbtfy_breadcrumbs_show_on_mobile or settings.dbtfy_breadcrumbs_show_social_media_on_desktop or settings.dbtfy_breadcrumbs_show_social_media_on_mobile -%}
      {%- liquid
        assign breadcrumbs_visibility_class = 'd-none'
        assign social_visibility_class = 'd-none'

        if settings.dbtfy_breadcrumbs_show_on_mobile
          assign breadcrumbs_visibility_class = 'd-flex'

          if settings.dbtfy_breadcrumbs_show_on_desktop != true
            assign breadcrumbs_visibility_class = breadcrumbs_visibility_class | append: ' d-md-none'
          endif
        elsif settings.dbtfy_breadcrumbs_show_on_desktop
          assign breadcrumbs_visibility_class = 'd-none d-md-flex'
        endif

        if settings.dbtfy_breadcrumbs_show_social_media_on_mobile
          assign social_visibility_class = 'd-flex'

          if settings.dbtfy_breadcrumbs_show_social_media_on_desktop != true
            assign social_visibility_class = social_visibility_class | append: ' d-md-none'
          endif
        elsif settings.dbtfy_breadcrumbs_show_social_media_on_desktop
          assign social_visibility_class = 'd-none d-md-flex'
        endif
      -%}

      {%- assign template_name = request.page_type | split: '.' | first -%}

      {%- capture separator -%}
        <li>
          <span class="{{ settings.icon }} icon icon--sm" translate="no" aria-hidden="true">keyboard_arrow_right</span>
        </li>
      {%- endcapture -%}

      <nav class="dbtfy-breadcrumbs text-accent text-sm color-{{ settings.dbtfy_breadcrumbs_color_scheme }} color-text">
        <div class="container">
          <div class="row row-cols-auto overflow-hidden align-items-center{% if settings.dbtfy_breadcrumbs_show_social_media_on_mobile %} flex-wrap flex-md-nowrap{% else %} flex-nowrap{% endif %}">
            <div class="dbtfy-breadcrumbs__item w-100 flex-fill {{ breadcrumbs_visibility_class }}">
              <ul class="w-100 w-md-auto inline-list justify-content-center justify-content-md-start align-items-center" role="navigation" aria-label="breadcrumbs">
                <li>
                  <a href="{{ routes.root_url }}" aria-label="{{ shop.name | capitalize }}" title="{{ shop.name | capitalize }}">
                    <span class="{{ settings.icon }} icon icon--sm" translate="no" aria-hidden="true">home</span>
                  </a>
                </li>

                {{- separator -}}

                {%- case template_name -%}
                  {%- when 'page' -%}
                    <li>
                      <a href="{{ page.url }}" aria-current="page">{{ page.title }}</a>
                    </li>

                  {%- when 'product' -%}
                    {%- if collection.url -%}
                      <li>
                        {{ collection.title | link_to: collection.url }}
                      </li>

                      {{- separator -}}
                    {%- endif -%}

                    <li>
                      <a href="{{ product.url }}" aria-current="page">{{ product.title }}</a>
                    </li>

                  {%- when 'collection' and collection.handle -%}
                    {%- if current_tags -%}
                      <li>
                        {{ collection.title | link_to: collection.url }}
                      </li>

                      {{- separator -}}

                      <li>
                        {%- capture tag_url -%}{{ collection.url }}/{{ current_tags | join: "+" }}{%- endcapture -%}
                        <a href="{{ tag_url }}" aria-current="page">{{ current_tags | join: " + " }}</a>
                      </li>
                    {%- else -%}
                      <li>
                        <a href="{{ collection.url }}" aria-current="page">{{ collection.title }}</a>
                      </li>
                    {%- endif -%}

                  {%- when 'blog' -%}
                    {%- if current_tags -%}
                      <li>
                        {{ blog.title | link_to: blog.url }}
                      </li>

                      {{- separator -}}

                      <li>
                        {%- capture tag_url -%}{{ blog.url }}/tagged/{{ current_tags | join: '+' }}{%- endcapture -%}
                        <a href="{{ tag_url }}" aria-current="page">{{ current_tags | join: ' + ' }}</a>
                      </li>
                    {%- else -%}
                      <li>
                        <a href="{{ blog.url }}" aria-current="page">{{ blog.title }}</a>
                      </li>
                    {%- endif -%}

                  {%- when 'article' -%}
                    <li>
                      {{ blog.title | link_to: blog.url }}
                    </li>

                    {{- separator -}}

                    <li>
                      <a href="{{ article.url }}" aria-current="page">{{ article.title }}</a>
                    </li>
                  {%- else -%}
                    <li>
                      <a href="{{ request.path }}" aria-current="page">{{ page_title }}</a>
                    </li>
                {%- endcase -%}
              </ul>
            </div>

            <div class="dbtfy-breadcrumbs__item w-100 w-md-auto {{ social_visibility_class }}{% if settings.dbtfy_breadcrumbs_show_social_media_on_mobile %} flex-fill flex-md-shrink-0{% endif %}{% if settings.dbtfy_breadcrumbs_show_social_media_on_desktop %} col-auto{% else %} flex-fill{% endif %}">
              {%- render 'social-sharing', show_icon: true, show_label: true, share_button: 'text-base' -%}
            </div>
          </div>
        </div>
      </nav>
    {%- endif -%}
  {%- endunless -%}
{%- endif -%}
